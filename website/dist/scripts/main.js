"use strict";function bodyOnLoad(){doPollingLoopIteration(),setInterval(doPollingLoopIteration,LOOP_INTERVAL)}function doPollingLoopIteration(){contents.length>0&&contents[0];loadContentsIndex(function(o,n){if(o){if(o.code&&o.code.includes("NoSuchKey"))return console.log("No content index exists."),void showError("CONTENT INDEX IS NOT AVAILABLE");console.error(o),showError(o)}else{var e=contents[0];console.log("Latest Content ID = "+e),console.log("Loading Content ID = "+loadingContentId),console.log("Playing Content ID = "+playingContentId),autoPlay&&playingContentId!==e&&checkIfContentFileExists(e,function(o,n){o?(console.log("Top content file does not exist."),showComingSoon("Next : "+e)):(console.log("Top content file exists. Loading..."),loadVideo(e))})}})}function setupVideo(o){Hls.isSupported()?(hls&&hls.destroy(),hls=new Hls({autoStartLoad:!0,debug:!1}),hls.on(Hls.Events.MANIFEST_PARSED,function(){console.log("Video parsed. Playing..."),showError(""),showComingSoon(""),playingContentId=loadingContentId,loadingContentId=void 0,showNowPlaying("Now Playing : "+playingContentId),document.getElementById("video").play()}),hls.on(Hls.Events.LEVEL_SWITCHING,function(o,n){console.log("EVENT.LEVEL_SWITCHING = "+JSON.stringify(n,2))}),hls.on(Hls.Events.ERROR,function(o,n){var e=n.type,t=n.details,l=(n.fatal,n.reason?", reason = "+n.reason:""),i="ERROR: type = "+e+", details = "+t+l;console.error(i),showError(i)}),hls.attachMedia(video),o(null,null)):o("HLS - NOT SUPPORTED")}function loadVideo(o){console.log("loadVideo: "+o);var n=CONTENTS_FOLDER+o+PLAYLIST_FILENAME;console.log("URL = "+n),document.getElementById("video").pause(),setupVideo(function(e,t){if(e)return console.error(e),void showError(e);loadingContentId=o,hls.loadSource(n)})}function updateContentsIndex(){console.log("updateContentsIndex");var o="";contents.forEach(function(n){o+="<a href=\"javascript:autoPlay = false; loadVideo('"+n+"');\">"+n+"</a><br/>"}),document.getElementById("contents").innerHTML=o}function loadContentsIndex(o){console.log("loadContentsIndex"),loadFileFromS3(CONTENTS_FOLDER+INDEX_FILENAME,function(n,e){if(n)return o(n);try{contents=JSON.parse(e),updateContentsIndex(),showError(""),o(null,null)}catch(n){o(n)}})}function loadFileFromWebsite(o,n){console.log("loadFileFromWebsite: "+o);var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE)if(200===e.status)n(null,e.responseText);else{var t="ERROR: Failed to load file ("+o+") : "+e.status+" "+e.statusText;n(t,null)}},e.open("GET",o,!0),e.send(null)}function loadFileFromS3(o,n){console.log("loadFileFromS3: "+o),AWS.config.update({customUserAgent:"MobileHub v0.1 SimpleVideoTranscoding",region:aws_content_delivery_bucket_region}),new AWS.S3({apiVersion:"2006-03-01",params:{Bucket:aws_content_delivery_bucket}}).getObject({Key:o},function(o,e){if(o)return void n(o);var t=e.Body.toString("utf-8");n(null,t)})}function checkIfContentFileExists(o,n){loadFileFromWebsite(CONTENTS_FOLDER+o+PLAYLIST_FILENAME,n)}function showNowPlaying(o){document.getElementById("now-playing").innerHTML=o}function showComingSoon(o){document.getElementById("coming-soon").innerHTML=o}function showError(o){document.getElementById("error").innerHTML=o}var CONTENTS_FOLDER="content/",PLAYLIST_FILENAME="/default.m3u8",INDEX_FILENAME="index.json",LOOP_INTERVAL=1e4,contents=[],hls,loadingContentId,playingContentId,autoPlay=!0;